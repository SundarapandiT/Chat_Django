{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Application</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body>
    <div id="app">
        <!-- Auth Container (Login/Register) -->
        <div id="auth-container" class="auth-container">
            <!-- Login Form -->
            <div id="login-box" class="auth-box">
                <h1>Welcome Back</h1>
                <p class="auth-subtitle">Sign in to continue to Chat</p>
                
                <div id="login-error" class="auth-error" style="display: none;"></div>
                
                <form id="login-form" class="auth-form">
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email" placeholder="Enter your email" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" placeholder="Enter your password" required>
                    </div>
                    
                    <button type="submit" class="auth-button" id="login-btn">Sign In</button>
                </form>
                
                <p class="auth-link">
                    Don't have an account? <a href="#" id="show-register">Sign up</a>
                </p>
            </div>
            
            <!-- Register Form -->
            <div id="register-box" class="auth-box" style="display: none;">
                <h1>Create Account</h1>
                <p class="auth-subtitle">Join Chat today</p>
                
                <div id="register-error" class="auth-error" style="display: none;"></div>
                
                <form id="register-form" class="auth-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="register-firstname">First Name</label>
                            <input type="text" id="register-firstname" placeholder="First name">
                        </div>
                        
                        <div class="form-group">
                            <label for="register-lastname">Last Name</label>
                            <input type="text" id="register-lastname" placeholder="Last name">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="register-username">Username</label>
                        <input type="text" id="register-username" placeholder="Choose a username" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="register-email">Email</label>
                        <input type="email" id="register-email" placeholder="Enter your email" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="register-password">Password</label>
                        <input type="password" id="register-password" placeholder="Create a password" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="register-password-confirm">Confirm Password</label>
                        <input type="password" id="register-password-confirm" placeholder="Confirm your password" required>
                    </div>
                    
                    <button type="submit" class="auth-button" id="register-btn">Create Account</button>
                </form>
                
                <p class="auth-link">
                    Already have an account? <a href="#" id="show-login">Sign in</a>
                </p>
            </div>
        </div>
        
        <!-- Chat Container -->
        <div id="chat-container" class="chat-layout" style="display: none;">
            <!-- Sidebar -->
            <div id="sidebar" class="sidebar">
                <div class="sidebar-header">
                    <div class="user-info">
                        <div class="user-avatar" id="current-user-avatar">
                            <span id="current-user-initial">U</span>
                        </div>
                        <div class="user-details">
                            <h3 id="current-user-name">Username</h3>
                            <span class="user-status">Online</span>
                        </div>
                    </div>
                    <div class="sidebar-actions">
                        <button class="icon-button" id="new-chat-btn" title="New chat">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                            </svg>
                        </button>
                        <button class="icon-button" id="logout-btn" title="Logout">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                                <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div class="sidebar-search">
                    <input type="text" id="search-conversations" placeholder="Search conversations...">
                </div>
                
                <div id="conversation-list" class="conversation-list">
                    <!-- Conversations will be loaded here -->
                </div>
            </div>
            
            <!-- Main Chat Area -->
            <div class="chat-main">
                <!-- No Chat Selected -->
                <div id="no-chat-selected" class="no-chat-selected">
                    <div class="no-chat-content">
                        <svg viewBox="0 0 24 24" width="64" height="64" fill="#ccc">
                            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>
                        </svg>
                        <h2>Select a conversation</h2>
                        <p>Choose from your existing conversations or start a new one</p>
                        <button class="start-chat-button" id="start-new-chat-btn">Start New Chat</button>
                    </div>
                </div>
                
                <!-- Chat Window -->
                <div id="chat-window" class="chat-window" style="display: none;">
                    <!-- Chat Header -->
                    <div class="chat-header">
                        <button class="back-button" id="back-btn">
                            <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                                <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                            </svg>
                        </button>
                        
                        <div class="chat-header-info">
                            <h3 id="chat-title">Chat Name</h3>
                            <span id="chat-status" class="status">Online</span>
                        </div>
                        
                        <div class="chat-header-actions">
                            <button class="icon-button" title="More options">
                                <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                                    <path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Messages Container -->
                    <div id="messages-container" class="messages-container">
                        <!-- Messages will be loaded here -->
                    </div>
                    
                    <!-- Typing Indicator -->
                    <div id="typing-indicator" class="typing-indicator" style="display: none;">
                        <div class="typing-dots">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                        <span id="typing-text">Someone is typing...</span>
                    </div>
                    
                    <!-- Message Input -->
                    <div class="message-input-container">
                        <!-- Reply Bar -->
                        <div id="reply-bar" class="reply-bar" style="display: none;">
                            <div class="reply-info">
                                <span class="reply-label">Replying to</span>
                                <span id="reply-sender" class="reply-sender"></span>
                                <span id="reply-text" class="reply-text"></span>
                            </div>
                            <button class="cancel-reply" id="cancel-reply-btn">
                                <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                                    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                                </svg>
                            </button>
                        </div>
                        
                        <!-- File Preview -->
                        <div id="file-preview-container" class="file-preview-container" style="display: none;">
                            <!-- File previews will be added here -->
                        </div>
                        
                        <!-- Input Wrapper -->
                        <div class="message-input-wrapper">
                            <button class="input-action-button" id="attach-btn" title="Attach file">
                                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                                    <path d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"/>
                                </svg>
                            </button>
                            <input type="file" id="file-input" multiple style="display: none;" accept="image/*,.pdf,.doc,.docx,.txt,.mp4,.webm,.mp3,.wav">
                            
                            <textarea id="message-input" placeholder="Type a message..." rows="1"></textarea>
                            
                            <div class="emoji-picker-container">
                                <button class="input-action-button" id="emoji-btn" title="Add emoji">
                                    <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                                        <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"/>
                                    </svg>
                                </button>
                                
                                <div id="emoji-picker" class="emoji-picker" style="display: none;">
                                    <button>üòÄ</button>
                                    <button>üòÇ</button>
                                    <button>‚ù§Ô∏è</button>
                                    <button>üëç</button>
                                    <button>üéâ</button>
                                    <button>üî•</button>
                                    <button>üòé</button>
                                    <button>ü§î</button>
                                    <button>üëã</button>
                                    <button>‚ú®</button>
                                </div>
                            </div>
                            
                            <button class="send-button" id="send-btn">
                                <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                                    <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- New Chat Modal -->
        <div id="new-chat-modal" class="modal-overlay" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>New Conversation</h2>
                    <button class="close-button" id="close-modal-btn">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                        </svg>
                    </button>
                </div>
                
                <div class="modal-body">
                    <div id="selected-users" class="selected-users">
                        <!-- Selected users will appear here -->
                    </div>
                    
                    <div class="search-input-container">
                        <input type="text" id="user-search" placeholder="Search users by username...">
                    </div>
                    
                    <div id="search-results" class="search-results">
                        <!-- Search results will appear here -->
                    </div>
                    
                    <div id="group-options" class="group-options" style="display: none;">
                        <label class="checkbox-label">
                            <input type="checkbox" id="is-group-chat">
                            <span>Create as group chat</span>
                        </label>
                        
                        <input type="text" id="group-name" class="group-name-input" placeholder="Group name (optional)" style="display: none;">
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button class="cancel-button" id="cancel-modal-btn">Cancel</button>
                    <button class="create-button" id="create-chat-btn" disabled>Start Chat</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Configuration -->
    <script>
        const CONFIG = {
            API_URL: '{{ api_url }}',
            WS_URL: '{{ ws_url }}',
        };
    </script>
    
    <!-- Scripts -->
    <script src="{% static 'js/api.js' %}"></script>
    <script src="{% static 'js/websocket.js' %}"></script>
    <script src="{% static 'js/auth.js' %}"></script>
    <script src="{% static 'js/chat.js' %}"></script>
    <script src="{% static 'js/app.js' %}"></script>
</body>
</html>